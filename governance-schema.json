{
	"$schema": "https://json-schema.org/draft-07/schema",
	"title": "VIP governance rules JSON schema",
	"definitions": {
		"allowedBlocksArray": {
			"description": "Array of allowed blocks for this rule. Blocks can contain asterisks for pattern matching.",
			"type": "array",
			"items": {
				"type": "string",
				"examples": [ "core/*", "core/paragraph", "core/heading" ]
			},
			"minItems": 1
		},
		"blockSettingsProperties": {
			"description": "Block settings for block or nested inner block types",
			"type": "object",
			"properties": {
				"allowedChildren": {
					"$ref": "#/definitions/allowedBlocksArray"
				}
			},
			"patternProperties": {
				"^[a-z][a-z0-9-]*/[a-z][a-z0-9-]*$": {
					"$ref": "#/definitions/blockSettingsProperties"
				}
			}
		},
		"ruleBlockSettingsProperties": {
			"description": "Theme.json block settings for this rule. Allows block nesting and allowedBlocks array.",
			"type": "object",
			"patternProperties": {
				"^[a-z][a-z0-9-]*/[a-z][a-z0-9-]*$": {
					"$ref": "#/definitions/blockSettingsProperties"
				}
			},
			"additionalProperties": false,
			"examples": [
				{
					"core/paragraph": {
						"color": {
							"text": false
						}
					},
					"core/quote": {
						"allowedBlocks": [ "core/paragraph", "core/heading" ]
					},
					"core/media-text": {
						"core/heading": {
							"typography": {
								"customFontSize": false
							}
						}
					}
				}
			]
		},
		"ruleDefaultProperties": {
			"type": "object",
			"properties": {
				"type": {
					"description": "Default rule - applies additively to all users.",
					"type": "string",
					"enum": [ "default" ]
				},
				"allowedBlocks": {
					"$ref": "#/definitions/allowedBlocksArray"
				},
				"blockSettings": {
					"$ref": "#/definitions/ruleBlockSettingsProperties"
				}
			},
			"error": {
				"message": "Default rule must have type 'default', can only contain allowedBlocks and blockSettings and cannot have role set"
			},
			"required": [ "type" ],
			"additionalProperties": false,
			"minProperties": 2,
			"maxProperties": 3
		},
		"ruleRoleProperties": {
			"type": "object",
			"properties": {
				"type": {
					"description": "Role rule - applies to one or more specific roles.",
					"type": "string",
					"enum": [ "role" ]
				},
				"roles": {
					"type": "array",
					"items": {
						"type": "string"
					},
					"examples": [ [ "administrator", "editor" ] ]
				},
				"allowedBlocks": {
					"$ref": "#/definitions/allowedBlocksArray"
				},
				"blockSettings": {
					"$ref": "#/definitions/ruleBlockSettingsProperties"
				}
			},
			"required": [ "type", "roles" ],
			"additionalProperties": false,
			"minProperties": 3,
			"maxProperties": 4
		}
	},
	"type": "object",
	"default": {},
	"required": [ "rules" ],
	"properties": {
		"$schema": {
			"description": "JSON schema URI for governance JSON",
			"type": "string"
		},
		"version": {
			"description": "Version of governance JSON",
			"type": "string",
			"examples": [ "0.1.0" ]
		},
		"rules": {
			"description": "Array of governance rules",
			"type": "array",
			"default": [],
			"items": {
				"type": "object",
				"oneOf": [
					{ "$ref": "#/definitions/ruleDefaultProperties" },
					{ "$ref": "#/definitions/ruleRoleProperties" }
				]
			}
		}
	},
	"additionalProperties": false
}
