(()=>{"use strict";const e=window.wp.hooks,t=window.wp.data,n=window.wp.blockEditor,o=window.wp.notices,i=window.wp.i18n,r=window.lodash;function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["allowedBlocks"];for(const[r,l]of Object.entries(e))if(!o.includes(r))if(r.includes("/"))Object.entries(e).forEach((e=>{let[n,i]=e;o.includes(n)||c(i,t,n)}));else if(!1!==n){var i;const e=s(l,`${r}.`);t[n]={...null!==(i=t[n])&&void 0!==i?i:{},...e}}return t}function l(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{depth:0,value:void 0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const[c,...s]=e,a=n[c];if(0===s.length){const e=(0,r.get)(a,t);return void 0!==e&&i>=o.depth&&(o.depth=i,o.value=e),o}return void 0!==a&&(o=l(s,t,a,o,i+1)),l(s,t,n,o,i)}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};return Object.entries(e).forEach((e=>{let[o,i]=e;"object"==typeof i&&i&&!Array.isArray(i)?(n[`${t}${o}`]=!0,Object.assign(n,s(i,`${t}${o}.`))):n[`${t}${o}`]=!0})),n}const a=window.wp.element,d=window.wp.components,u=window.wp.compose,p={"core/list":["core/list-item"],"core/columns":["core/column"],"core/page-list":["core/page-list-item"],"core/navigation":["core/navigation-link","core/navigation-submenu"],"core/navigation-link":["core/navigation-link","core/navigation-submenu","core/page-list"],"core/quote":["core/paragraph"],"core/media-text":["core/paragraph"],"core/social-links":["core/social-link"],"core/comments-pagination":["core/comments-pagination-previous","core/comments-pagination-numbers","core/comments-pagination-next"]};function g(t,n,o){const i=(0,e.applyFilters)("vip_governance__is_block_allowed_in_hierarchy",!0,t,n,o)||0===n.length?[...o.allowedBlocks]:[];if(n.length>0){if(p[n[0]]&&p[n[0]].includes(t))return!0;if(o.blockSettings){const e=l(n.reverse(),"allowedBlocks",o.blockSettings);e&&e.value&&i.push(...e.value)}}return function(e,t){return t.some((t=>function(e,t){return t.includes("*")?e.match(new RegExp(t.replace("*",".*"))):t===e}(e,t)))}(t,i)}const m={};!function(){if(VIP_GOVERNANCE.error)return void(0,t.dispatch)(o.store).createErrorNotice(VIP_GOVERNANCE.error,{id:"wpcomvip-governance-error",isDismissible:!0,actions:[{label:(0,i.__)("Open governance settings"),url:VIP_GOVERNANCE.urlSettingsPage}]});const r=VIP_GOVERNANCE.governanceRules;(0,e.addFilter)("blockEditor.__unstableCanInsertBlockType","wpcomvip-governance/block-insertion",((o,i,c,l)=>{let{getBlock:s}=l;if(!1===o)return o;let a=[];if(c){const{getBlockParents:e,getBlockName:o}=(0,t.select)(n.store),i=s(c),r=e(c,!0);a=[i.clientId,...r].map((e=>o(e)))}const d=g(i.name,a,r);return(0,e.applyFilters)("vip_governance__is_block_allowed_for_insertion",d,i.name,a,r)}));const s=VIP_GOVERNANCE.nestedSettings,p=c(s);(0,e.addFilter)("blockEditor.useSetting.before","wpcomvip-governance/nested-block-settings",((e,o,i,r)=>{if(void 0===p[r]||!0!==p[r][o])return e;const c=[i,...(0,t.select)(n.store).getBlockParents(i,!0)].map((e=>(0,t.select)(n.store).getBlockName(e))).reverse();return({value:e}=l(c,o,s)),e&&e.theme?e.theme:e})),r?.allowedBlocks&&function(o){const i=(0,u.createHigherOrderComponent)((i=>r=>{const{name:c,clientId:l}=r,{getBlockParents:s,getBlockName:u}=(0,t.select)(n.store),p=s(l,!0),v=p.some((e=>function(e){return e in m}(e)));if(v)return(0,a.createElement)(i,r);const w=p.map((e=>u(e)));let k=g(c,w,o);return k=(0,e.applyFilters)("vip_governance__is_block_allowed_for_editing",k,c,w,o),k?(0,a.createElement)(i,r):(function(e){m[e]=!0}(l),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Disabled,null,(0,a.createElement)("div",{style:{opacity:.6,"background-color":"#eee",border:"2px dashed #999"}},(0,a.createElement)(i,r)))))}),"withDisabledBlocks");(0,e.addFilter)("editor.BlockEdit","wpcomvip-governance/with-disabled-blocks",i)}(r)}()})();