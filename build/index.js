(()=>{"use strict";const e=window.wp.hooks,t=window.wp.data,o=window.wp.blockEditor,n=window.wp.notices,l=window.wp.i18n,r=window.lodash,c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["allowedBlocks","allowedChildren"];for(const[r,i]of Object.entries(e))if(!n.includes(r))if(r.includes("/"))Object.entries(e).forEach((e=>{let[o,l]=e;n.includes(o)||c(l,t,o)}));else if(!1!==o){var l;const e=s(i,`${r}.`);t[o]={...null!==(l=t[o])&&void 0!==l?l:{},...e}}return t},i=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{depth:0,value:void 0},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const[c,...s]=e,d=o[c];if(0===s.length){const e=(0,r.get)(d,t);return void 0!==e&&l>=n.depth&&(n.depth=l,n.value=e),n}return void 0!==d&&(n=i(s,t,d,n,l+1)),i(s,t,o,n,l)};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o={};return Object.entries(e).forEach((e=>{let[n,l]=e;"object"==typeof l&&l&&!Array.isArray(l)?(o[`${t}${n}`]=!0,Object.assign(o,s(l,`${t}${n}.`))):o[`${t}${n}`]=!0})),o}function d(e,t){return t.includes("*")?e.match(new RegExp(t.replace("*",".*"))):t===e}function a(e,t){return t.some((t=>d(e,t)))}const w=window.wp.element,g=window.wp.components,u=window.wp.compose;!function(){if(VIP_GOVERNANCE.error)return void(0,t.dispatch)(n.store).createErrorNotice(VIP_GOVERNANCE.error,{id:"wpcomvip-governance-error",isDismissible:!0,actions:[{label:(0,l.__)("Open governance settings"),url:VIP_GOVERNANCE.urlSettingsPage}]});const r=VIP_GOVERNANCE.governanceRules;(0,e.addFilter)("blockEditor.__unstableCanInsertBlockType","wpcomvip-governance/block-insertion",((t,o,n,l)=>{let{getBlock:c}=l;return((t,o,n,l,r)=>{let{getBlock:c}=r,i=t;return l&&!n?i=a(o.name,l.allowedBlocks):l&&n&&(i=function(e,t,o,n,l){const r=o(e);return l.blockSettings&&l.blockSettings[r.name]&&l.blockSettings[r.name].allowedChildren?a(t.name,l.blockSettings[r.name].allowedChildren):1===l.allowedBlocks.length&&"*"===l.allowedBlocks[0]&&n}(n,o,c,i,l)),(0,e.applyFilters)("vip_governance__is_block_allowed_for_insertion",i,o,l,n,c)})(t,o,n,r,{getBlock:c})}));const s=VIP_GOVERNANCE.nestedSettings,p=c(s);(0,e.addFilter)("blockEditor.useSetting.before","wpcomvip-governance/nested-block-settings",((e,n,l,r)=>{const c=void 0!==p[r]&&!0===p[r][n];if(void 0!==e||!c)return e;const d=[l,...(0,t.select)(o.store).getBlockParents(l,!0)].map((e=>(0,t.select)(o.store).getBlockName(e))).reverse();return({value:e}=i(d,n,s)),e})),r?.allowedBlocks&&function(n){const l=(0,u.createHigherOrderComponent)((e=>l=>{const{name:r,clientId:c}=l,{getBlockParents:i,getBlockAttributes:s}=(0,t.select)(o.store),a=i(c,!0);return a.some((e=>!0===s(e)["vip-governance-locked"]))||n.allowedBlocks.some((e=>d(r,e)||a.length>0))?(0,w.createElement)(e,l):(l.setAttributes({"vip-governance-locked":!0}),(0,w.createElement)(w.Fragment,null,(0,w.createElement)(g.Disabled,null,(0,w.createElement)("div",{style:{opacity:.6,"background-color":"#eee",border:"2px dashed #999"}},(0,w.createElement)(e,l)))))}),"withDisabledBlocks");(0,e.addFilter)("editor.BlockEdit","wpcomvip-governance/with-disabled-blocks",l)}(r)}()})();