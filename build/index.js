(()=>{"use strict";const e=window.wp.hooks,t=window.wp.data,n=window.wp.blockEditor,o=window.wp.notices,r=window.wp.i18n,i=window.lodash,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["allowedBlocks","allowedChildren"];for(const[i,c]of Object.entries(e))if(!o.includes(i))if(i.includes("/"))Object.entries(e).forEach((e=>{let[n,r]=e;o.includes(n)||l(r,t,n)}));else if(!1!==n){var r;const e=s(c,`${i}.`);t[n]={...null!==(r=t[n])&&void 0!==r?r:{},...e}}return t},c=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{depth:0,value:void 0},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const[l,...s]=e,d=n[l];if(0===s.length){const e=(0,i.get)(d,t);return void 0!==e&&r>=o.depth&&(o.depth=r,o.value=e),o}return void 0!==d&&(o=c(s,t,d,o,r+1)),c(s,t,n,o,r)};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};return Object.entries(e).forEach((e=>{let[o,r]=e;"object"==typeof r&&r&&!Array.isArray(r)?(n[`${t}${o}`]=!0,Object.assign(n,s(r,`${t}${o}.`))):n[`${t}${o}`]=!0})),n}const d=window.wp.element,a=window.wp.components,g=window.wp.compose;function u(e,t,n){if(t.length>0){const o=t[0];if(n.blockSettings&&n.blockSettings[String(o)]&&n.blockSettings[String(o)].allowedChildren)return p(e,n.blockSettings[String(o)].allowedChildren)}return p(e,n.allowedBlocks)}function p(e,t){return t.some((t=>function(e,t){return t.includes("*")?e.match(new RegExp(t.replace("*",".*"))):t===e}(e,t)))}!function(){if(VIP_GOVERNANCE.error)return void(0,t.dispatch)(o.store).createErrorNotice(VIP_GOVERNANCE.error,{id:"wpcomvip-governance-error",isDismissible:!0,actions:[{label:(0,r.__)("Open governance settings"),url:VIP_GOVERNANCE.urlSettingsPage}]});const i=VIP_GOVERNANCE.governanceRules;(0,e.addFilter)("blockEditor.__unstableCanInsertBlockType","wpcomvip-governance/block-insertion",((o,r,l,c)=>{let{getBlock:s}=c;if(!1===o)return o;let d=[];if(l){const{getBlockParents:e,getBlockName:o}=(0,t.select)(n.store),r=s(l),i=e(l,!0);d=[r.clientId,...i].map((e=>o(e)))}const a=u(r.name,d,i);return(0,e.applyFilters)("vip_governance__is_block_allowed_for_insertion",a,r.name,d,i)}));const s=VIP_GOVERNANCE.nestedSettings,p=l(s);(0,e.addFilter)("blockEditor.useSetting.before","wpcomvip-governance/nested-block-settings",((e,o,r,i)=>{const l=void 0!==p[i]&&!0===p[i][o];if(void 0!==e||!l)return e;const d=[r,...(0,t.select)(n.store).getBlockParents(r,!0)].map((e=>(0,t.select)(n.store).getBlockName(e))).reverse();return({value:e}=c(d,o,s)),e})),i?.allowedBlocks&&function(o){const r=(0,g.createHigherOrderComponent)((r=>i=>{const{name:l,clientId:c}=i,{getBlockParents:s,getBlockAttributes:g,getBlockName:p}=(0,t.select)(n.store),w=s(c,!0);if(w.some((e=>!0===g(e)["vip-governance-locked"])))return(0,d.createElement)(r,i);const v=w.map((e=>p(e)));let k=u(l,v,o);return k=(0,e.applyFilters)("vip_governance__is_block_allowed_for_editing",k,l,v,o),k?(0,d.createElement)(r,i):(i.setAttributes({"vip-governance-locked":!0}),(0,d.createElement)(d.Fragment,null,(0,d.createElement)(a.Disabled,null,(0,d.createElement)("div",{style:{opacity:.6,"background-color":"#eee",border:"2px dashed #999"}},(0,d.createElement)(r,i)))))}),"withDisabledBlocks");(0,e.addFilter)("editor.BlockEdit","wpcomvip-governance/with-disabled-blocks",r)}(i)}()})();
